
library(methods)
library(demest)
library(docopt)
library(dplyr)

'
Usage:
model.R [options]

Options:
--n_burnin [default: 5]
--n_sim [default: 5]
--n_chain [default: 4]
--n_thin [default: 1]
--add_lexis [default: FALSE]
' -> doc
opts <- docopt(doc)
n_burnin <- opts$n_burnin %>% as.integer()
n_sim <- opts$n_sim %>% as.integer()
n_chain <- opts$n_chain %>% as.integer()
n_thin <- opts$n_thin %>% as.integer()
add_lexis <- opts$add_lexis %>% as.logical()


set.seed(0)

account <- readRDS("out/account.rds")
system_models <- readRDS("out/system_models.rds")
if (add_lexis) {
    datasets <- readRDS("out/datasets.rds")
} else {
    datasets <- readRDS("out/datasets_lex.rds")
}
data_models <- readRDS("out/data_models.rds")

filename <- if (add_lexis) "out/model_lex.est" else "out/model.est"

Sys.time()

estimateAccount(account = account,
                systemModels = system_models,
                datasets = datasets,
                dataModels = data_models,
                filename = filename,
                nBurnin = n_burnin,
                nSim = n_sim,
                nChain = n_chain,
                nThin = n_thin)
Sys.time()


options(width = 120)
fetchSummary(filename)
